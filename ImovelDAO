package javaapplication1.dao;

import javaapplication1.model.Imovel;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;

public class ImovelDAO {

    public List<Imovel> listAll() throws SQLException {
        String sql = "SELECT id, descricao FROM imoveis ORDER BY id";
        try (Connection c = Database.getConnection();
             PreparedStatement ps = c.prepareStatement(sql);
             ResultSet rs = ps.executeQuery()) {

            List<Imovel> res = new ArrayList<>();
            while (rs.next()) {
                res.add(new Imovel(rs.getInt("id"), rs.getString("descricao")));
            }
            return res;
        }
    }

    public Imovel create(String descricao) throws SQLException {
        String sql = "INSERT INTO imoveis(descricao) VALUES (?)";
        try (Connection c = Database.getConnection();
             PreparedStatement ps = c.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {

            ps.setString(1, descricao);
            ps.executeUpdate();

            try (ResultSet rs = ps.getGeneratedKeys()) {
                rs.next();
                return new Imovel(rs.getInt(1), descricao);
            }
        }
    }
}
