package javaapplication1.config;

import java.sql.Connection;
import java.sql.Statement;
import javaapplication1.dao.Database;

public class CreateTables {

    public static void main(String[] args) {
        try (Connection conn = Database.getConnection();
             Statement stmt = conn.createStatement()) {

            System.out.println("Conectado ao banco! Criando tabelas...");

            stmt.executeUpdate(
                    "CREATE TABLE IF NOT EXISTS users (" +
                            "id INT AUTO_INCREMENT PRIMARY KEY," +
                            "email VARCHAR(255) NOT NULL UNIQUE," +
                            "password VARCHAR(255) NOT NULL," +
                            "role ENUM('CLIENTE', 'CORRETOR') NOT NULL" +
                            ")"
            );

            stmt.executeUpdate(
                    "CREATE TABLE IF NOT EXISTS imoveis (" +
                            "id INT AUTO_INCREMENT PRIMARY KEY," +
                            "descricao VARCHAR(255) NOT NULL" +
                            ")"
            );

            stmt.executeUpdate(
                    "CREATE TABLE IF NOT EXISTS visitas (" +
                            "id INT AUTO_INCREMENT PRIMARY KEY," +
                            "cliente_id INT NOT NULL," +
                            "imovel_id INT NOT NULL," +
                            "data_hora DATETIME NOT NULL," +
                            "status ENUM('PENDENTE', 'APROVADO', 'RECUSADO') DEFAULT 'PENDENTE'," +
                            "FOREIGN KEY (cliente_id) REFERENCES users(id)," +
                            "FOREIGN KEY (imovel_id) REFERENCES imoveis(id)" +
                            ")"
            );

            System.out.println("✔ Tabelas criadas com sucesso!");

            //INSERT DOS IMÓVEIS PADRÃO
            stmt.executeUpdate(
                    "INSERT INTO imoveis (descricao) VALUES " +
                            "('Casa 3 quartos no Centro')," +
                            "('Apartamento 2 quartos - Próximo ao shopping')," +
                            "('Cobertura 4 quartos com vista panorâmica')," +
                            "('Kitnet mobiliada - Bairro Universitário')," +
                            "('Casa térrea 2 quartos com garagem')"
            );

            System.out.println("✔ Imóveis inseridos com sucesso!");

        } catch (Exception e) {
            System.out.println("Erro ao criar tabelas ou inserir dados: " + e.getMessage());
            e.printStackTrace();
        }
    }
}
